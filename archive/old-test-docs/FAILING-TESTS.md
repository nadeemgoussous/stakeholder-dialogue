# Failing Tests - To Be Fixed

**Last Updated**: 2025-12-05
**Test Run**: Session 4 - Post Tailwind v4 Fix
**Overall Status**: 46/56 passing (82%)

## Failing Tests Summary

### 1. Text Selector Issues (4 tests)

**Test**: `should load the welcome page`
**Files**: `01-app-loads.spec.ts:8`
**Browsers**: Chromium, Firefox, WebKit, Mobile Safari
**Error**: Strict mode violation - `text=Offline-First Design` resolves to 2 elements

```
Error: strict mode violation: locator('text=Offline-First Design') resolved to 2 elements:
    1) <h3 class="text-sm font-medium text-green-800">Offline-First Design</h3>
    2) <p class="text-xs text-gray-400 mt-2">Version 1.0.0 • Offline-First Design</p>
```

**Fix Required**: Make the selector more specific
```typescript
// Current (fails):
await expect(page.locator('text=Offline-First Design')).toBeVisible();

// Fix option 1 - Use role selector:
await expect(page.getByRole('heading', { name: 'Offline-First Design' })).toBeVisible();

// Fix option 2 - Use more specific selector:
await expect(page.locator('h3:has-text("Offline-First Design")')).toBeVisible();
```

**Priority**: LOW - Easy fix, doesn't block functionality

---

### 2. PWA Offline Cache Tests (4 tests)

**Test**: `should load page after going offline (PWA cache)`
**Files**: `02-offline-functionality.spec.ts:37`
**Browsers**: Chromium, WebKit, Mobile Safari
**Error**: Cannot navigate while offline

```
Chromium: Error: page.goto: net::ERR_INTERNET_DISCONNECTED at http://localhost:5174/
WebKit: Error: page.goto: WebKit encountered an internal error
Mobile Safari: Error: page.goto: net::ERR_INTERNET_DISCONNECTED
```

**Root Cause**: Service worker not fully configured or registered
- vite-plugin-pwa configured in vite.config.ts
- Service worker registration attempted in main.tsx but may not be working correctly

**Fix Required**:
1. Verify service worker is actually being generated by vite-plugin-pwa
2. Check if service worker registers successfully in browser DevTools
3. May need to adjust PWA configuration for development mode
4. Consider using `networkTimeoutSeconds` in workbox config
5. Test needs to wait for service worker activation before going offline

**Priority**: MEDIUM - Important for offline-first requirement, but complex to fix

**Note**: Firefox PWA test PASSES - investigate why Firefox works but Chromium doesn't

---

### 3. TypeScript Compilation Timeout (3 tests)

**Test**: `should compile TypeScript without errors`
**Files**: `03-typescript-compilation.spec.ts:12`
**Browsers**: Chromium, Firefox, WebKit
**Error**: Test timeout of 30000ms exceeded

**Root Cause**: `tsc --noEmit` takes longer than 30 seconds on Windows
- Test runs `npx tsc --noEmit` which validates all TypeScript files
- Windows filesystem and antivirus can slow down tsc significantly
- 30-second timeout is too aggressive for larger projects

**Fix Required**:
```typescript
// Current:
test('should compile TypeScript without errors', async () => {
  const { stdout, stderr } = await execAsync('npx tsc --noEmit');
  // Timeout: 30000ms (default)
});

// Fix option 1 - Increase timeout:
test('should compile TypeScript without errors', async () => {
  const { stdout, stderr } = await execAsync('npx tsc --noEmit');
}, 60000); // 60 second timeout

// Fix option 2 - Use incremental compilation:
test('should compile TypeScript without errors', async () => {
  const { stdout, stderr } = await execAsync('npx tsc --noEmit --incremental');
}, 45000);
```

**Priority**: LOW - TypeScript compilation works (dev server runs), just test timeout issue

**Note**: Mobile Safari test PASSES - likely runs faster or uses different test config

---

## Test Results by Browser

### Chromium
- ✅ 10 passing
- ❌ 3 failing
  - Text selector (1)
  - PWA cache (1)
  - TypeScript timeout (1)

### Firefox
- ✅ 12 passing
- ❌ 2 failing
  - Text selector (1)
  - TypeScript timeout (1)
- ✅ PWA cache test PASSES (only browser where it works!)

### WebKit
- ✅ 10 passing
- ❌ 3 failing
  - Text selector (1)
  - PWA cache (1)
  - TypeScript timeout (1)

### Mobile Safari
- ✅ 14 passing
- ❌ 2 failing
  - Text selector (1)
  - PWA cache (1)
- ✅ TypeScript test PASSES

---

## Action Plan

### Immediate (Before F004)
- [x] Document all failing tests (this file)
- [ ] Fix text selector to use more specific locator (5 minutes)

### Short-term (During F004-F006)
- [ ] Increase TypeScript compilation test timeout to 60s
- [ ] Investigate why Firefox PWA test passes but others fail

### Medium-term (After core features)
- [ ] Debug service worker registration in development mode
- [ ] Add proper wait for service worker activation in tests
- [ ] Consider using Playwright's `serviceWorkers` API for better control
- [ ] Test PWA functionality manually in production build

---

## Notes

- **All feature-critical tests pass**: Technology factors (F005), app loading, offline detection
- **Failures are test infrastructure issues**, not feature bugs
- **Firefox most compatible**: PWA tests work, suggesting service worker is functional
- **Mobile Safari fastest**: TypeScript compilation doesn't timeout
- **Core offline functionality works**: Offline detection and UI display all pass

---

## Related Files

- `tests/e2e/01-app-loads.spec.ts` - App loading tests
- `tests/e2e/02-offline-functionality.spec.ts` - PWA and offline tests
- `tests/e2e/03-typescript-compilation.spec.ts` - Type checking tests
- `vite.config.ts` - PWA configuration
- `src/main.tsx` - Service worker registration

---

## Test Output Location

Full test results saved in:
- `test-results/` - Screenshots and traces for failed tests
- `playwright-report/` - HTML report (run `npx playwright show-report`)
